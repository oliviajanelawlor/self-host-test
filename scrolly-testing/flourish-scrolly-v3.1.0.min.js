var initFlourishScrolly=function(){"use strict";function E(t){for(var e=[t];t;t=t.parentNode)e.unshift(t);return e}function I(t,e){var i=E(t),o=E(e);if(i[0]!=o[0])throw"No common ancestor!";for(var n=0;n<i.length;n++)if(i[n]!=o[n])return i[n-1]}function k(t){console.warn("📜📜📜 Flourish Scrolly\n"+t)}function o(t){void 0===t?t={}:"object"!=typeof t&&(k("Invalid argument "+t+" passed into initFlourishScrolly. If specified this should be an object. See the README for more information!"),t={});var e={force_overflow:{val:!0},trigger_point:{val:"10%",validate:function(t){return i(t)?(k("opts.trigger_point value "+t+" supplied without a unit. Treating as "+t+"px."),t+"px"):"%"!=t[t.length-1]&&"px"!=t.slice(t.length-2)?(k("opts.trigger_point must be specified in % or px. Falling back to default value of "+e.trigger_point.val),e.trigger_point.val):t}},offset_top:{val:"0px",validate:o},offset_bottom:{val:"0px",validate:o},section_class_names:{val:[],validate:n},step_class_names:{val:[],validate:n},step_styles:{val:{width:"50%",height:"auto",marginTop:"0",marginBottom:"90vh",marginLeft:"auto",marginRight:"auto",paddingTop:"1.25em",paddingRight:"1.25em",paddingBottom:"1.25em",paddingLeft:"1.25em",background:"rgba(255,255,255,0.9)",boxShadow:"0px 0px 10px rgba(0,0,0,0.2)",borderRadius:"10px",textAlign:"center",color:"black"}},link_styles:{val:{color:"inherit",textDecoration:"none",border:"none",cursor:"default"}}};function i(t){return"number"==typeof t||"string"==typeof t&&t==parseFloat(t).toString()}function o(t){return i(t)?(k("Option value "+t+" supplied without a unit. Treating as "+t+"px."),t+"px"):t}function n(t){return"string"==typeof t?[t]:Array.isArray(t)?t:(k("Option value "+t+" is invalid and being ignored. It should be a string or an array."),[])}for(var r in t)e.hasOwnProperty(r)||k("Ignoring invalid option: "+r);for(var r in e){var s=e[r];if(r in t&&s.validate&&(t[r]=s.validate(t[r])),r in t){if("object"==typeof s.val)for(var a in s.val)a in t[r]||(t[r][a]=s.val[a])}else t[r]=s.val}return t}var x={};function l(t){for(var e,i=t.getAttribute("href").split("/"),o=parseFloat(i[i.length-1].replace("slide-",""))-1,n=t.parentNode;!e&&(e=n.querySelector(".flourish-embed iframe, .flourish-embed-iframe"),n=n.parentNode););e&&(e.src=e.src.replace(/#slide-.*/,"")+"#slide-"+o)}var t,R=(function(f){!function(d,u){var t=function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t};function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e,p=!1,i=void 0!==d;i&&d.getComputedStyle?(e=u.createElement("div"),["","-webkit-","-moz-","-ms-"].some(function(t){try{e.style.position=t+"sticky"}catch(t){}return""!=e.style.position})&&(p=!0)):p=!0;var r=!1,g="undefined"!=typeof ShadowRoot,s={top:null,left:null},a=[];function m(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function v(t){return parseFloat(t)||0}function y(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}var n=(t(l,[{key:"refresh",value:function(){if(!p&&!this._removed){this._active&&this._deactivate();var t=this._node,e=getComputedStyle(t),i={position:e.position,top:e.top,display:e.display,marginTop:e.marginTop,marginBottom:e.marginBottom,marginLeft:e.marginLeft,marginRight:e.marginRight,cssFloat:e.cssFloat};if(!isNaN(parseFloat(i.top))&&"table-cell"!=i.display&&"none"!=i.display){this._active=!0;var o=t.style.position;"sticky"!=e.position&&"-webkit-sticky"!=e.position||(t.style.position="static");var n=t.parentNode,r=g&&n instanceof ShadowRoot?n.host:n,s=t.getBoundingClientRect(),a=r.getBoundingClientRect(),l=getComputedStyle(r);this._parent={node:r,styles:{position:r.style.position},offsetHeight:r.offsetHeight},this._offsetToWindow={left:s.left,right:u.documentElement.clientWidth-s.right},this._offsetToParent={top:s.top-a.top-v(l.borderTopWidth),left:s.left-a.left-v(l.borderLeftWidth),right:-s.right+a.right-v(l.borderRightWidth)},this._styles={position:o,top:t.style.top,bottom:t.style.bottom,left:t.style.left,right:t.style.right,width:t.style.width,marginTop:t.style.marginTop,marginLeft:t.style.marginLeft,marginRight:t.style.marginRight};var c=v(i.top);this._limits={start:s.top+d.pageYOffset-c,end:a.top+d.pageYOffset+r.offsetHeight-v(l.borderBottomWidth)-t.offsetHeight-c-v(i.marginBottom)};var h=l.position;"absolute"!=h&&"relative"!=h&&(r.style.position="relative"),this._recalcPosition();var f=this._clone={};f.node=u.createElement("div"),m(f.node.style,{width:s.right-s.left+"px",height:s.bottom-s.top+"px",marginTop:i.marginTop,marginBottom:i.marginBottom,marginLeft:i.marginLeft,marginRight:i.marginRight,cssFloat:i.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),n.insertBefore(f.node,t),f.docOffsetTop=y(f.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var t=s.top<=this._limits.start?"start":s.top>=this._limits.end?"end":"middle";if(this._stickyMode!=t){switch(t){case"start":m(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":m(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":m(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=t}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(1<Math.abs(y(this._clone.node)-this._clone.docOffsetTop)||1<Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight))&&this.refresh()}},{key:"_deactivate",value:function(){var e=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,m(this._node.style,this._styles),delete this._styles,a.some(function(t){return t!==e&&t._parent&&t._parent.node===e._parent.node})||m(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var i=this;this._deactivate(),a.some(function(t,e){if(t._node===i._node)return a.splice(e,1),!0}),this._removed=!0}}]),l);function l(e){if(!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),!(e instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(a.some(function(t){return t._node===e}))throw new Error("Stickyfill is already applied to this node");this._node=e,this._stickyMode=null,this._active=!1,a.push(this),this.refresh()}var c={stickies:a,Sticky:n,forceSticky:function(){p=!1,h(),this.refreshAll()},addOne:function(t){if(!(t instanceof HTMLElement)){if(!t.length||!t[0])return;t=t[0]}for(var e=0;e<a.length;e++)if(a[e]._node===t)return a[e];return new n(t)},add:function(i){if(i instanceof HTMLElement&&(i=[i]),i.length){for(var o=[],t=function(t){var e=i[t];return e instanceof HTMLElement?a.some(function(t){if(t._node===e)return o.push(t),!0})?"continue":void o.push(new n(e)):(o.push(void 0),"continue")},e=0;e<i.length;e++)t(e);return o}},refreshAll:function(){a.forEach(function(t){return t.refresh()})},removeOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}a.some(function(t){if(t._node===e)return t.remove(),!0})},remove:function(i){if(i instanceof HTMLElement&&(i=[i]),i.length)for(var t=function(t){var e=i[t];a.some(function(t){if(t._node===e)return t.remove(),!0})},e=0;e<i.length;e++)t(e)},removeAll:function(){for(;a.length;)a[0].remove()}};function h(){if(!r){r=!0,o(),d.addEventListener("scroll",o),d.addEventListener("resize",c.refreshAll),d.addEventListener("orientationchange",c.refreshAll);var t=void 0,e=void 0,i=void 0;"hidden"in u?(e="hidden",i="visibilitychange"):"webkitHidden"in u&&(e="webkitHidden",i="webkitvisibilitychange"),i?(u[e]||n(),u.addEventListener(i,function(){u[e]?clearInterval(t):n()})):n()}function o(){d.pageXOffset!=s.left?(s.top=d.pageYOffset,s.left=d.pageXOffset,c.refreshAll()):d.pageYOffset!=s.top&&(s.top=d.pageYOffset,s.left=d.pageXOffset,a.forEach(function(t){return t._recalcPosition()}))}function n(){t=setInterval(function(){a.forEach(function(t){return t._fastCheck()})},500)}}p||h(),f.exports?f.exports=c:i&&(d.Stickyfill=c)}(window,document)}(t={exports:{}},t.exports),t.exports);return function(){if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}});else{var g=window.document;t.prototype.THROTTLE_TIMEOUT=100,t.prototype.POLL_INTERVAL=null,t.prototype.USE_MUTATION_OBSERVER=!0,t.prototype.observe=function(e){if(!this._observationTargets.some(function(t){return t.element==e})){if(!e||1!=e.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},t.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},t.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},t.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},t.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,i){if("number"!=typeof t||isNaN(t)||t<0||1<t)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==i[e-1]})},t.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},t.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(e(window,"resize",this._checkForIntersections,!0),e(g,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in window&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(g,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},t.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,i(window,"resize",this._checkForIntersections,!0),i(g,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},t.prototype._checkForIntersections=function(){var a=this._rootIsInDom(),l=a?this._getRootRect():r();this._observationTargets.forEach(function(t){var e=t.element,i=m(e),o=this._rootContainsTarget(e),n=t.entry,r=a&&o&&this._computeTargetAndRootIntersection(e,l),s=t.entry=new c({time:window.performance&&performance.now&&performance.now(),target:e,boundingClientRect:i,rootBounds:l,intersectionRect:r});n?a&&o?this._hasCrossedThreshold(n,s)&&this._queuedEntries.push(s):n&&n.isIntersecting&&this._queuedEntries.push(s):this._queuedEntries.push(s)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},t.prototype._computeTargetAndRootIntersection=function(t,e){if("none"!=window.getComputedStyle(t).display){for(var i,o,n,r,s,a,l,c,h=m(t),f=v(t),d=!1;!d;){var u=null,p=1==f.nodeType?window.getComputedStyle(f):{};if("none"==p.display)return;if(f==this.root||f==g?(d=!0,u=e):f!=g.body&&f!=g.documentElement&&"visible"!=p.overflow&&(u=m(f)),u&&(i=u,o=h,void 0,n=Math.max(i.top,o.top),r=Math.min(i.bottom,o.bottom),s=Math.max(i.left,o.left),a=Math.min(i.right,o.right),c=r-n,!(h=0<=(l=a-s)&&0<=c&&{top:n,bottom:r,left:s,right:a,width:l,height:c})))break;f=v(f)}return h}},t.prototype._getRootRect=function(){var t;if(this.root)t=m(this.root);else{var e=g.documentElement,i=g.body;t={top:0,left:0,right:e.clientWidth||i.clientWidth,width:e.clientWidth||i.clientWidth,bottom:e.clientHeight||i.clientHeight,height:e.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(t)},t.prototype._expandRectByRootMargin=function(i){var t=this._rootMarginValues.map(function(t,e){return"px"==t.unit?t.value:t.value*(e%2?i.width:i.height)/100}),e={top:i.top-t[0],right:i.right+t[1],bottom:i.bottom+t[2],left:i.left-t[3]};return e.width=e.right-e.left,e.height=e.bottom-e.top,e},t.prototype._hasCrossedThreshold=function(t,e){var i=t&&t.isIntersecting?t.intersectionRatio||0:-1,o=e.isIntersecting?e.intersectionRatio||0:-1;if(i!==o)for(var n=0;n<this.thresholds.length;n++){var r=this.thresholds[n];if(r==i||r==o||r<i!=r<o)return!0}},t.prototype._rootIsInDom=function(){return!this.root||o(g,this.root)},t.prototype._rootContainsTarget=function(t){return o(this.root||g,t)},t.prototype._registerInstance=function(){},t.prototype._unregisterInstance=function(){},window.IntersectionObserver=t,window.IntersectionObserverEntry=c}function c(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||r(),this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,i=e.width*e.height,o=this.intersectionRect,n=o.width*o.height;this.intersectionRatio=i?Number((n/i).toFixed(4)):this.isIntersecting?1:0}function t(t,e){var i,o,n,r=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(r.root&&1!=r.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=(i=this._checkForIntersections.bind(this),o=this.THROTTLE_TIMEOUT,n=null,function(){n=n||setTimeout(function(){i(),n=null},o)}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(r.rootMargin),this.thresholds=this._initThresholds(r.threshold),this.root=r.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function e(t,e,i,o){"function"==typeof t.addEventListener?t.addEventListener(e,i,o||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,i)}function i(t,e,i,o){"function"==typeof t.removeEventListener?t.removeEventListener(e,i,o||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,i)}function m(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):r()}function r(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function o(t,e){for(var i=e;i;){if(i==t)return!0;i=v(i)}return!1}function v(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e&&e.assignedSlot?e.assignedSlot.parentNode:e}}(),function(t){var e,i=o(t||{});(e=document.createElement("style")).innerHTML=".fl-scrolly-sticky {position: -webkit-sticky !important;position: sticky !important;}.fl-scrolly-section .fl-scrolly-step {position: relative !important;transform: translate3d(0,0,0) !important; /* Workaround for Safari https://stackoverflow.com/questions/50224855/not-respecting-z-index-on-safari-with-position-sticky */}",(document.head||document.body).appendChild(e),function(t){for(var e=document.getElementsByTagName("a"),i=0;i<e.length;i++){var o=(a=e[i]).getAttribute("href");if(o&&o.match(/#story\/\d+/)){var n=o.split("/")[1];for(var r in(x["story-"+n]=a).classList.add("fl-scrolly-link"),a.classList.add("story-"+n),t.link_styles)a.style[r]=t.link_styles[r];var s=a.parentNode;for(var r in s.classList.add("fl-scrolly-step"),t.step_class_names.forEach(function(t){s.classList.add(t)}),t.step_styles)s.style[r]=t.step_styles[r];a.addEventListener("click",function(t){t.preventDefault(),l(this)})}}for(var a in x)x[a].classList.add("fl-scrolly-last-link-"+a)}(i),function(t){for(var e=document.querySelectorAll(".flourish-embed, .flourish-embed-iframe"),i=0;i<e.length;i++){var o,n=e[i],r=n.getAttribute("data-src"),s=n.getAttribute("src"),a=n.getAttribute("data-id"),l=null!=s||null!=a;if(a?o=a.match(/^story\/(\d+)/):r?o=r.match(/^story\/(\d+)/):s&&(o=s.match(/^https:\/\/flo.uri.sh\/story\/(\d+)\/embed/)),o){for(var c=o[1],h=E(n),f=h.length-1;0<f;f--){var d=h[f],u=window.getComputedStyle(d);u&&"visible"!=u.overflow&&(t.force_overflow?(d.style.overflow="visible",k("Forcing `overflow: visible` on a parent element of an embedded story. This is required for scrollytelling to work, but it may have unexpected effects on your page, so check it carefully before publishing. This behavior can be disabled using the option `force_overflow: true`.")):k("One of the parent elements of an embedded story has an `overflow` style set to something other than the default “visible”. This is incompatible with scrollytelling! Try using the `force_overflow: true` option to fix this."))}var p=s?n.style.height:n.getAttribute("data-height");p||(p="100vh",k("Warning, for scrollytelling it's best to set a height on your story embeds to ensure that they get fixed centrally on the screen rather than at the top. We recommend doing this in “vh” units – e.g. data-height='100vh' will mean the graphics fill the screen. You can set this in the Flourish app when generating the embed code, or by adding the data-height attribute to your existing embed code."));var g=x["story-"+c];if(g){var m=I(n,g);n.id="story-"+c;var v=document.createElement("div");v.classList.add("fl-scrolly-section"),t.section_class_names.forEach(function(t){v.classList.add(t)}),v.style.position="relative",v.style.paddingBottom="1px",v.id="fl-scrolly-section-"+c,m.classList.add("fl-scrolly-parent-"+c);var y=document.querySelectorAll(".fl-scrolly-parent-"+c+" > *");n.__found_story__=!1;for(f=0;f<y.length;f++){var _=y[f];if(n.__found_story__){if(v.appendChild(_),_.querySelector(".fl-scrolly-last-link-story-"+c))break}else if(_.id=="story-"+c||_.querySelector("#story-"+c)){n.__found_story__=!0;var b="50vh + "+t.offset_top+"/2 - "+t.offset_bottom+"/2 - "+p+"/2";if(_.style.top="calc("+b+")",_.classList.add("fl-scrolly-sticky"),R.add(_),l&&_.isSameNode(n)){var w=n.nextElementSibling&&n.nextElementSibling.firstElementChild&&n.nextElementSibling.firstElementChild.classList.contains("flourish-credit")?n.nextElementSibling:null;if(w){var T=window.getComputedStyle(w);v.style.paddingBottom=w.offsetHeight+parseInt(T.marginTop)+parseInt(T.marginBottom)+"px",n.style.display="block",w.style.top="calc(("+b+") + "+_.getBoundingClientRect().height+"px + "+parseInt(T.marginTop)+"px + "+parseInt(T.marginBottom)+"px)",w.style.marginBottom="-"+(w.offsetHeight+parseInt(T.marginTop)+parseInt(T.marginBottom))+"px",w.classList.add("fl-scrolly-sticky"),R.add(w)}}m.insertBefore(v,_),v.appendChild(_)}}}}}}(i),function(t){for(var e=t.trigger_point,i=new IntersectionObserver(function(t,e){t.forEach(function(t){t.isIntersecting&&l(t.target)})},{rootMargin:"0px 0px -"+e+" 0px"}),o=document.querySelectorAll(".fl-scrolly-link"),n=0;n<o.length;n++)i.observe(o[n])}(i)}}();
//# sourceMappingURL=flourish-scrolly.min.js.map
